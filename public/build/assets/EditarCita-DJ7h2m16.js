import{g as u,i as V,D as K,B,c as $,a as d,u as h,h as Q,w as C,b as t,l as F,f as H,t as S,e as z,d as E,k as X,v as Z,o as x,x as ee,F as ae,C as te,q as oe}from"./app-SE4O8QdG.js";import{_ as re,a as le,S as L}from"./Card-6S7uMC2O.js";import se from"./DateCarousel-DniOaH12.js";import ne from"./TurnoSelector-D15EKVcJ.js";import ie from"./HoursCarousel-UvW0p_15.js";import ue from"./BarberosSerlectorEdit-zGcuubFB.js";import de from"./ServiciosReadOnly-C8WN9SDV.js";import{r as ce}from"./ArrowLeftIcon-0kNd3E0x.js";import"./useTheme-otSVn3jk.js";import"./useAccessibility-DclxZ0zr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SunIcon-DAM6hgzS.js";import"./ScissorsIcon-DPyk5GxX.js";const ve={class:"mb-6"},me={class:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"}},be={class:"max-w-4xl mx-auto"},pe={class:"mb-6 p-4 border-b",style:{borderColor:"var(--border-color)"}},fe={class:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-secondary)",borderLeft:"4px solid var(--color-primary)"}},ye={class:"font-semibold",style:{color:"var(--text-primary)"}},ge={class:"text-sm",style:{color:"var(--text-secondary)"}},he={class:"mb-6 p-4 border-b",style:{borderColor:"var(--border-color)"}},Ce={key:2,class:"flex gap-3 justify-end mt-6"},xe=["disabled"],ze={__name:"EditarCita",props:{cita:{type:Object,required:!0}},setup(v){const o=v,m=u(new Date),l=u(null),c=u(null),s=u(null),i=u(null),p=u((o.cita.estado||"pendiente").toLowerCase()),D=u(!1),b=u([]),f=u({fecha:o.cita.fecha,hora:o.cita.hora,barbero_id:o.cita.barbero?.id||null,estado:o.cita.estado||"pendiente"}),M=V(()=>{if(!c.value||!l.value)return[];const a=[];let e,r;switch(c.value){case"manana":e=9,r=12;break;case"tarde":e=14,r=18;break;case"noche":e=18,r=21;break}const n=new Date,[N,_,T]=l.value.date.split("-").map(Number),k=new Date(N,_-1,T),Y=k.getFullYear()===n.getFullYear()&&k.getMonth()===n.getMonth()&&k.getDate()===n.getDate();for(let y=e;y<r;y++)for(let g=0;g<60;g+=40){const G=y.toString().padStart(2,"0"),R=g.toString().padStart(2,"0"),J=`${G}:${R}`;let U=!1;Y&&(U=new Date(N,_-1,T,y,g,0,0)<=n),a.push({time:J,disabled:U})}return a}),w=V(()=>l.value?.date!==f.value.fecha||s.value!==f.value.hora||i.value!==f.value.barbero_id||p.value!==f.value.estado),W=V(()=>l.value&&s.value&&i.value),j=()=>{const a=new Date(m.value);a.setDate(a.getDate()-7),m.value=a},q=()=>{const a=new Date(m.value);a.setDate(a.getDate()+7),m.value=a},I=async()=>{if(!(!l.value||!s.value)){D.value=!0;try{const a=await te.post("/citas/barberos-disponibles-edicion-cliente",{fecha:l.value.date,hora:s.value,cita_id:o.cita.id});b.value=a.data.barberos.map(e=>({...e,avatar:A(e.nombre||e.name),disponible:!0})),o.cita.barbero&&b.value.find(e=>e.id===o.cita.barbero.id)?i.value=o.cita.barbero.id:i.value=null}catch(a){console.error("Error al cargar barberos:",a),L.fire({title:"Error",text:"No se pudieron cargar los barberos disponibles",icon:"error",confirmButtonColor:"#EF4444",background:"var(--bg-primary)",color:"var(--text-primary)"}),b.value=[]}finally{D.value=!1}}},A=a=>`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&size=150`,O=a=>{const[e]=a.split(":").map(Number);return e>=9&&e<14?"manana":e>=14&&e<18?"tarde":e>=18&&e<21?"noche":null},P=()=>{w.value&&L.fire({title:"¿Confirmar cambios?",text:"Se actualizará la fecha, hora, barbero o estado de la cita",icon:"question",showCancelButton:!0,confirmButtonColor:"var(--color-primary)",cancelButtonColor:"#6B7280",confirmButtonText:"Sí, actualizar",cancelButtonText:"Cancelar",background:"var(--bg-primary)",color:"var(--text-primary)"}).then(a=>{a.isConfirmed&&oe.put(route("citas-admin.update",o.cita.id),{fecha:l.value.date,hora:s.value,barbero_id:i.value,cliente_id:o.cita.cliente.id,estado:p.value.toLowerCase()})})};return K(()=>{const[a,e,r]=o.cita.fecha.split("-").map(Number),n=new Date(a,e-1,r);l.value={date:o.cita.fecha,day:n.getDate(),dayName:n.toLocaleDateString("es-ES",{weekday:"short"}),fullDate:n},c.value=O(o.cita.hora),s.value=o.cita.hora,p.value=(o.cita.estado||"pendiente").toLowerCase(),m.value=new Date(n),m.value.setDate(n.getDate()-n.getDay())}),B(l,a=>{a||(c.value=null,s.value=null,i.value=null,b.value=[])}),B(c,a=>{a||(s.value=null,i.value=null,b.value=[])}),B(s,a=>{a?I():(i.value=null,b.value=[])}),(a,e)=>(x(),$(ae,null,[d(h(Q),{title:"Editar Cita - Admin"}),d(le,null,{default:C(()=>[t("div",ve,[d(h(F),{href:a.route("citas-admin.show",v.cita.id),class:"inline-flex items-center gap-2 mb-4 hover:opacity-75 transition-opacity",style:{color:"var(--color-primary)"}},{default:C(()=>[d(h(ce),{class:"w-5 h-5"}),e[5]||(e[5]=H(" Volver a la Cita ",-1))]),_:1},8,["href"]),t("h1",me," Editar Cita #"+S(v.cita.id),1),e[6]||(e[6]=t("p",{style:{color:"var(--text-secondary)"}}," Modifica la fecha, hora, barbero o estado de la cita ",-1))]),t("div",be,[d(re,null,{default:C(()=>[t("div",pe,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold mb-3",style:{color:"var(--text-primary)"}}," Información del Cliente ",-1)),t("div",fe,[t("p",ye,S(v.cita.cliente.nombre),1),t("p",ge," Cliente ID: "+S(v.cita.cliente.id),1)])]),t("div",he,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-3",style:{color:"var(--text-primary)"}}," Estado de la Cita ",-1)),X(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),class:"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2",style:{borderColor:"var(--border-color)",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"}},[...e[8]||(e[8]=[t("option",{value:"pendiente"},"pendiente",-1),t("option",{value:"confirmada"},"confirmada",-1),t("option",{value:"completada"},"completada",-1),t("option",{value:"cancelada"},"cancelada",-1)])],512),[[Z,p.value]])]),d(se,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value=r),"current-week-start":m.value,onPreviousWeek:j,onNextWeek:q},null,8,["modelValue","current-week-start"]),d(ne,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=r=>c.value=r)},null,8,["modelValue"]),l.value&&c.value?(x(),z(ie,{key:0,modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=r=>s.value=r),"available-hours":M.value},null,8,["modelValue","available-hours"])):E("",!0),l.value&&s.value?(x(),z(ue,{key:1,modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=r=>i.value=r),barberos:b.value,loading:D.value},null,8,["modelValue","barberos","loading"])):E("",!0),d(de,{servicios:v.cita.servicios},null,8,["servicios"]),W.value?(x(),$("div",Ce,[d(h(F),{href:a.route("citas-admin.show",v.cita.id),class:"px-6 py-3 rounded-lg font-semibold transition-all hover:opacity-75",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"}},{default:C(()=>[...e[10]||(e[10]=[H(" Cancelar ",-1)])]),_:1},8,["href"]),t("button",{onClick:P,disabled:!w.value,class:ee(["px-6 py-3 rounded-lg font-semibold transition-all",w.value?"hover:opacity-90":"opacity-50 cursor-not-allowed"]),style:{backgroundColor:"var(--color-primary)",color:"white"}}," Guardar Cambios ",10,xe)])):E("",!0)]),_:1})])]),_:1})],64))}};export{ze as default};
