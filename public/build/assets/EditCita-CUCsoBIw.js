import{g as c,i as x,D as R,B as V,c as T,a as i,u as h,h as J,w as g,b,l as $,f as F,t as K,e as H,d as B,o as y,x as Q,F as X,C as Z,q as ee}from"./app-SE4O8QdG.js";import{_ as ae,a as te,S as U}from"./Card-6S7uMC2O.js";import re from"./DateCarousel-CskZCbMp.js";import oe from"./TurnoSelector-Cn4uedW1.js";import le from"./HoursCarousel-BYSXd-Ar.js";import ne from"./ServiciosReadOnly-jkHE3_uF.js";import se from"./BarberosSerlectorEdit-CiMv88St.js";import{r as ie}from"./ArrowLeftIcon-0kNd3E0x.js";import"./useTheme-otSVn3jk.js";import"./useAccessibility-DclxZ0zr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SunIcon-DAM6hgzS.js";import"./ScissorsIcon-DPyk5GxX.js";const ue={class:"mb-6"},ce={class:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"}},de={class:"max-w-4xl mx-auto"},ve={key:2,class:"flex gap-3 justify-end mt-6"},me=["disabled"],_e={__name:"EditCita",props:{cita:{type:Object,required:!0}},setup(m){const o=m,d=c(new Date),r=c(null),u=c(null),l=c(null),s=c(null),D=c(!1),v=c([]),w=c({fecha:o.cita.fecha,hora:o.cita.hora,barbero_id:o.cita.barbero?.id||null}),z=x(()=>{if(!u.value||!r.value)return[];const a=[];let e,t;switch(u.value){case"manana":e=9,t=12;break;case"tarde":e=14,t=18;break;case"noche":e=18,t=21;break}const n=new Date,[S,_,N]=r.value.date.split("-").map(Number),k=new Date(S,_-1,N),A=k.getFullYear()===n.getFullYear()&&k.getMonth()===n.getMonth()&&k.getDate()===n.getDate();for(let f=e;f<t;f++)for(let p=0;p<60;p+=40){const G=f.toString().padStart(2,"0"),I=p.toString().padStart(2,"0"),L=`${G}:${I}`;let E=!1;A&&(E=new Date(S,_-1,N,f,p,0,0)<=n),a.push({time:L,disabled:E})}return a}),C=x(()=>r.value?.date!==w.value.fecha||l.value!==w.value.hora||s.value!==w.value.barbero_id),W=x(()=>r.value&&l.value&&s.value),M=()=>{const a=new Date(d.value);a.setDate(a.getDate()-7),d.value=a},j=()=>{const a=new Date(d.value);a.setDate(a.getDate()+7),d.value=a},q=async()=>{if(!(!r.value||!l.value)){D.value=!0;try{const a=await Z.post("/citas/barberos-disponibles-edicion-cliente",{fecha:r.value.date,hora:l.value,cita_id:o.cita.id});console.log(a.data),v.value=a.data.barberos.map(e=>({...e,avatar:O(e.nombre),disponible:!0})),o.cita.barbero&&v.value.find(e=>e.id===o.cita.barbero.id)?s.value=o.cita.barbero.id:s.value=null}catch(a){console.error("Error al cargar barberos:",a),U.fire({title:"Error",text:"No se pudieron cargar los barberos disponibles",icon:"error",confirmButtonColor:"#EF4444",background:"var(--bg-primary)",color:"var(--text-primary)"}),v.value=[]}finally{D.value=!1}}},O=a=>`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&size=150`,P=a=>{const[e]=a.split(":").map(Number);return e>=9&&e<14?"manana":e>=14&&e<18?"tarde":e>=18&&e<21?"noche":null},Y=()=>{C.value&&U.fire({title:"¿Confirmar cambios?",text:"Se actualizará la fecha, hora o barbero de tu cita",icon:"question",showCancelButton:!0,confirmButtonColor:"var(--color-primary)",cancelButtonColor:"#6B7280",confirmButtonText:"Sí, actualizar",cancelButtonText:"Cancelar",background:"var(--bg-primary)",color:"var(--text-primary)"}).then(a=>{a.isConfirmed&&ee.put(route("citas-cliente.update",o.cita.id),{fecha:r.value.date,hora:l.value,barbero_id:s.value})})};return R(()=>{const[a,e,t]=o.cita.fecha.split("-").map(Number),n=new Date(a,e-1,t);r.value={date:o.cita.fecha,day:n.getDate(),dayName:n.toLocaleDateString("es-ES",{weekday:"short"}),fullDate:n},u.value=P(o.cita.hora),l.value=o.cita.hora,d.value=new Date(n),d.value.setDate(n.getDate()-n.getDay())}),V(r,a=>{a||(u.value=null,l.value=null,s.value=null,v.value=[])}),V(u,a=>{a||(l.value=null,s.value=null,v.value=[])}),V(l,a=>{a?q():(s.value=null,v.value=[])}),(a,e)=>(y(),T(X,null,[i(h(J),{title:"Editar Cita"}),i(te,null,{default:g(()=>[b("div",ue,[i(h($),{href:a.route("citas-cliente.show",m.cita.id),class:"inline-flex items-center gap-2 mb-4 hover:opacity-75 transition-opacity",style:{color:"var(--color-primary)"}},{default:g(()=>[i(h(ie),{class:"w-5 h-5"}),e[4]||(e[4]=F(" Volver a la Cita ",-1))]),_:1},8,["href"]),b("h1",ce," Editar Cita #"+K(m.cita.id),1),e[5]||(e[5]=b("p",{style:{color:"var(--text-secondary)"}}," Modifica la fecha, hora o barbero de tu cita ",-1))]),b("div",de,[i(ae,null,{default:g(()=>[i(re,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),"current-week-start":d.value,onPreviousWeek:M,onNextWeek:j},null,8,["modelValue","current-week-start"]),i(oe,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t)},null,8,["modelValue"]),r.value&&u.value?(y(),H(le,{key:0,modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value=t),"available-hours":z.value},null,8,["modelValue","available-hours"])):B("",!0),r.value&&l.value?(y(),H(se,{key:1,modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value=t),barberos:v.value,loading:D.value},null,8,["modelValue","barberos","loading"])):B("",!0),i(ne,{servicios:m.cita.servicios},null,8,["servicios"]),W.value?(y(),T("div",ve,[i(h($),{href:a.route("citas-cliente.show",m.cita.id),class:"px-6 py-3 rounded-lg font-semibold transition-all hover:opacity-75",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"}},{default:g(()=>[...e[6]||(e[6]=[F(" Cancelar ",-1)])]),_:1},8,["href"]),b("button",{onClick:Y,disabled:!C.value,class:Q(["px-6 py-3 rounded-lg font-semibold transition-all",C.value?"hover:opacity-90":"opacity-50 cursor-not-allowed"]),style:{backgroundColor:"var(--color-primary)",color:"white"}}," Guardar Cambios ",10,me)])):B("",!0)]),_:1})])]),_:1})],64))}};export{_e as default};
