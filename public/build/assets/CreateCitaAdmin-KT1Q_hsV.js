import{g as u,i as m,B as D,c as Q,a as v,u as P,h as X,w as S,b as f,l as Z,f as ee,e as h,d as C,o as b,F as ae,C as le,q as te}from"./app-SE4O8QdG.js";import{_ as oe,a as re,S as W}from"./Card-6S7uMC2O.js";import ne from"./ClienteSearchAdmin-CxvTL5W_.js";import ue from"./DateCarousel-DniOaH12.js";import ie from"./TurnoSelector-D15EKVcJ.js";import se from"./HoursCarousel-UvW0p_15.js";import ve from"./BarberoSelector-Bjr13AbH.js";import ce from"./ServiciosList-BqKlb78D.js";import de from"./CitaResumen-TRLxOT2-.js";import"./useTheme-otSVn3jk.js";import"./useAccessibility-DclxZ0zr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SunIcon-DAM6hgzS.js";const me={class:"mb-6"},fe={class:"max-w-4xl mx-auto"},Ee={__name:"CreateCitaAdmin",props:{porcentajeReserva:{type:Number,default:0}},setup(A){const T=A,c=u(null),p=u(new Date),r=u(null),i=u(null),t=u(null),n=u(null),o=u([]),w=u({}),x=u(!1),s=u([]),V=u([]),B=m(()=>{if(!i.value||!r.value)return[];const a=[];let e,l;switch(i.value){case"manana":e=9,l=12;break;case"tarde":e=14,l=18;break;case"noche":e=18,l=21;break}const d=new Date,[U,F,j]=r.value.date.split("-").map(Number),_=new Date(U,F-1,j),z=_.getFullYear()===d.getFullYear()&&_.getMonth()===d.getMonth()&&_.getDate()===d.getDate();for(let y=e;y<l;y++)for(let k=0;k<60;k+=40){const G=y.toString().padStart(2,"0"),J=k.toString().padStart(2,"0"),L=`${G}:${J}`;let H=!1;z&&(H=new Date(U,F-1,j,y,k,0,0)<=d),a.push({time:L,disabled:H})}return a}),M=m(()=>{if(!n.value)return[];const a=s.value.find(e=>e.id===n.value);return a?a.servicios:[]}),E=m(()=>o.value.reduce((a,e)=>a+e.duracion_estimada,0)),g=m(()=>o.value.reduce((a,e)=>a+e.precio,0)),$=m(()=>g.value===0?0:g.value*(T.porcentajeReserva/100)),N=m(()=>r.value&&t.value&&n.value&&o.value.length>0),R=()=>{r.value=null,i.value=null,t.value=null,n.value=null,o.value=[],w.value={},s.value=[],V.value=[]},Y=()=>{const a=new Date(p.value);a.setDate(a.getDate()-7),p.value=a},I=()=>{const a=new Date(p.value);a.setDate(a.getDate()+7),p.value=a},K=async()=>{if(!(!r.value||!t.value)){x.value=!0;try{const a=await le.post("/citas/barberos-disponibles-admin",{cliente_id:c.value?c.value.id:null,fecha:r.value.date,hora:t.value});s.value=a.data.barberos.map(e=>({...e,avatar:O(e.name),disponible:!0})),V.value=a.data.servicios||[],n.value=null,o.value=[]}catch(a){console.error("Error al cargar barberos:",a),alert("Error al cargar los datos. Por favor intenta nuevamente."),s.value=[],V.value=[]}finally{x.value=!1}}},O=a=>`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&size=150`,q=()=>{if(!N.value)return;const a={cliente_id:c.value?c.value.id:null,fecha:r.value.date,hora:t.value,barbero_id:n.value,servicios:o.value.map(e=>e.id),monto_total:g.value,duracion_total:E.value,pago_inicial:$.value};console.log("Datos de la cita:",a),te.post("/cita-admin/store",a,{preserveScroll:!0,onError:e=>{console.log(e),e&&e.error?(alert(e.error),W.fire({title:"Error",text:e.error||"Error al confirmar la cita",icon:"error",confirmButtonColor:"#EF4444",background:"var(--bg-primary)",color:"var(--text-primary)"})):W.fire({title:"Error",text:e.error||"Error al confirmar la cita",icon:"error",confirmButtonColor:"#EF4444",background:"var(--bg-primary)",color:"var(--text-primary)"})}})};return D(r,a=>{a||(i.value=null,t.value=null,n.value=null,o.value=[],s.value=[])}),D(i,a=>{if(!a)t.value=null,n.value=null,o.value=[],s.value=[];else if(t.value){const e=B.value.find(l=>l.time===t.value);e&&e.disabled&&(t.value=null)}}),D(t,a=>{a?K():(n.value=null,o.value=[],s.value=[])}),D(n,(a,e)=>{if(e!==void 0){const d=e===null?"todos":e;o.value.length>0&&(w.value[d]=[...o.value])}const l=a===null?"todos":a;o.value=w.value[l]||[]}),(a,e)=>(b(),Q(ae,null,[v(P(X),{title:"Crear Cita - Admin"}),v(re,null,{default:S(()=>[f("div",me,[v(P(Z),{href:a.route("citas-admin.index"),class:"inline-flex items-center gap-2 mb-4 hover:opacity-75 transition-opacity",style:{color:"var(--color-primary)"}},{default:S(()=>[...e[6]||(e[6]=[f("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),ee(" Volver ",-1)])]),_:1},8,["href"]),e[7]||(e[7]=f("h1",{class:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"}}," Crear Cita (Administrador) ",-1)),e[8]||(e[8]=f("p",{style:{color:"var(--text-secondary)"}}," Busca un cliente (opcional) y selecciona fecha, hora y servicio para la cita ",-1))]),f("div",fe,[v(oe,null,{default:S(()=>[v(ne,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),onCleared:R},null,8,["modelValue"]),v(ue,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),"current-week-start":p.value,onPreviousWeek:Y,onNextWeek:I},null,8,["modelValue","current-week-start"]),v(ie,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l)},null,8,["modelValue"]),r.value&&i.value?(b(),h(se,{key:0,modelValue:t.value,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value=l),"available-hours":B.value},null,8,["modelValue","available-hours"])):C("",!0),r.value&&t.value?(b(),h(ve,{key:1,modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value=l),barberos:s.value,loading:x.value},null,8,["modelValue","barberos","loading"])):C("",!0),r.value&&t.value&&n.value?(b(),h(ce,{key:2,modelValue:o.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value=l),servicios:M.value},null,8,["modelValue","servicios"])):C("",!0),o.value.length>0?(b(),h(de,{key:3,"total-duracion":E.value,"total-precio":g.value,"pago-inicial":$.value,"can-confirm":N.value,onConfirmar:q},null,8,["total-duracion","total-precio","pago-inicial","can-confirm"])):C("",!0)]),_:1})])]),_:1})],64))}};export{Ee as default};
