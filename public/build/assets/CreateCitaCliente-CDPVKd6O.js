import{g as n,i as c,B as k,c as G,a as d,u as P,h as J,w as V,b as m,l as L,f as Q,e as D,d as y,o as p,F as X,C as Z,q as ee}from"./app-SE4O8QdG.js";import{_ as ae,a as te}from"./Card-6S7uMC2O.js";import le from"./DateCarousel-CskZCbMp.js";import oe from"./TurnoSelector-Cn4uedW1.js";import re from"./HoursCarousel-BYSXd-Ar.js";import ue from"./BarberoSelector-DA27f-yQ.js";import ne from"./ServiciosList-Vwrd8W6U.js";import se from"./CitaResumen-Bdj_Qkmo.js";import"./useTheme-otSVn3jk.js";import"./useAccessibility-DclxZ0zr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SunIcon-DAM6hgzS.js";const ie={class:"mb-6"},ve={class:"max-w-4xl mx-auto"},Ve={__name:"CreateCitaCliente",props:{porcentajeReserva:{type:Number,default:0}},setup(W){const F=W,f=n(new Date),r=n(null),s=n(null),l=n(null),u=n(null),o=n([]),C=n({}),w=n(!1),i=n([]),S=n([]),_=c(()=>{if(!s.value||!r.value)return[];const a=[];let e,t;switch(s.value){case"manana":e=9,t=12;break;case"tarde":e=14,t=18;break;case"noche":e=18,t=21;break}const v=new Date,[U,j,E]=r.value.date.split("-").map(Number),x=new Date(U,j-1,E),O=x.getFullYear()===v.getFullYear()&&x.getMonth()===v.getMonth()&&x.getDate()===v.getDate();for(let g=e;g<t;g++)for(let h=0;h<60;h+=40){const q=g.toString().padStart(2,"0"),z=h.toString().padStart(2,"0"),A=`${q}:${z}`;let H=!1;O&&(H=new Date(U,j-1,E,g,h,0,0)<=v),a.push({time:A,disabled:H})}return a}),R=c(()=>{if(!u.value)return[];const a=i.value.find(e=>e.id===u.value);return a?a.servicios:[]}),B=c(()=>o.value.reduce((a,e)=>a+e.duracion_estimada,0)),b=c(()=>o.value.reduce((a,e)=>a+e.precio,0)),N=c(()=>b.value===0?0:b.value*(F.porcentajeReserva/100)),$=c(()=>r.value&&l.value&&u.value&&o.value.length>0),T=()=>{const a=new Date(f.value);a.setDate(a.getDate()-7),f.value=a},M=()=>{const a=new Date(f.value);a.setDate(a.getDate()+7),f.value=a},Y=async()=>{if(!(!r.value||!l.value)){w.value=!0;try{const a=await Z.post("/api/citas/barberos-disponibles",{fecha:r.value.date,hora:l.value});i.value=a.data.barberos.map(e=>({...e,avatar:I(e.nombre),disponible:!0})),S.value=a.data.servicios,u.value=null,o.value=[]}catch(a){console.error("Error al cargar barberos:",a),alert("Error al cargar los datos. Por favor intenta nuevamente."),i.value=[],S.value=[]}finally{w.value=!1}}},I=a=>`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&size=150`,K=()=>{if(!$.value)return;const a={fecha:r.value.date,hora:l.value,barbero_id:u.value,servicios:o.value.map(e=>e.id),monto_total:b.value,duracion_total:B.value,pago_inicial:N.value};console.log("Datos de la cita:",a),ee.post("/cita/store",a,{preserveScroll:!0,onSuccess:()=>{alert("Â¡Cita confirmada exitosamente!")},onError:e=>{e&&e.error?alert(e.error):alert("Error al confirmar la cita")}})};return k(r,a=>{a||(s.value=null,l.value=null,u.value=null,o.value=[],i.value=[])}),k(s,a=>{if(!a)l.value=null,u.value=null,o.value=[],i.value=[];else if(l.value){const e=_.value.find(t=>t.time===l.value);e&&e.disabled&&(l.value=null)}}),k(l,a=>{a?Y():(u.value=null,o.value=[],i.value=[])}),k(u,(a,e)=>{if(e!==void 0){const v=e===null?"todos":e;o.value.length>0&&(C.value[v]=[...o.value])}const t=a===null?"todos":a;o.value=C.value[t]||[]}),(a,e)=>(p(),G(X,null,[d(P(J),{title:"Nueva Cita"}),d(te,null,{default:V(()=>[m("div",ie,[d(P(L),{href:a.route("citas.index"),class:"inline-flex items-center gap-2 mb-4 hover:opacity-75 transition-opacity",style:{color:"var(--color-primary)"}},{default:V(()=>[...e[5]||(e[5]=[m("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),Q(" Volver ",-1)])]),_:1},8,["href"]),e[6]||(e[6]=m("h1",{class:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"}}," Reservar Nueva Cita ",-1)),e[7]||(e[7]=m("p",{style:{color:"var(--text-secondary)"}}," Selecciona fecha, hora y servicio para tu cita ",-1))]),m("div",ve,[d(ae,null,{default:V(()=>[d(le,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),"current-week-start":f.value,onPreviousWeek:T,onNextWeek:M},null,8,["modelValue","current-week-start"]),d(oe,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value=t)},null,8,["modelValue"]),r.value&&s.value?(p(),D(re,{key:0,modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value=t),"available-hours":_.value},null,8,["modelValue","available-hours"])):y("",!0),r.value&&l.value?(p(),D(ue,{key:1,modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value=t),barberos:i.value,loading:w.value},null,8,["modelValue","barberos","loading"])):y("",!0),r.value&&l.value&&u.value?(p(),D(ne,{key:2,modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value=t),servicios:R.value},null,8,["modelValue","servicios"])):y("",!0),o.value.length>0?(p(),D(se,{key:3,"total-duracion":B.value,"total-precio":b.value,"pago-inicial":N.value,"can-confirm":$.value,onConfirmar:K},null,8,["total-duracion","total-precio","pago-inicial","can-confirm"])):y("",!0)]),_:1})])]),_:1})],64))}};export{Ve as default};
