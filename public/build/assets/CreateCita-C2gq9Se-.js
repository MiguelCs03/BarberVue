import{g as c,i as m,B as x,c as oe,a as D,u as L,h as re,w as H,b as h,l as ne,f as ue,e as C,d as V,o as w,F as se,C as ie,q as ce}from"./app-SE4O8QdG.js";import{_ as ve,a as de,S as A}from"./Card-6S7uMC2O.js";import me from"./DateCarousel-CskZCbMp.js";import fe from"./TurnoSelector-Cn4uedW1.js";import pe from"./HoursCarousel-BYSXd-Ar.js";import ge from"./BarberoSelector-DA27f-yQ.js";import be from"./ServiciosList-Vwrd8W6U.js";import De from"./CitaResumen-Bdj_Qkmo.js";import"./useTheme-otSVn3jk.js";import"./useAccessibility-DclxZ0zr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SunIcon-DAM6hgzS.js";const he={class:"mb-6"},ye={class:"max-w-4xl mx-auto"},I="America/La_Paz",He={__name:"CreateCita",props:{porcentajeReserva:{type:Number,default:0}},setup(R){const Z=R,_=()=>new Date(new Date().toLocaleString("en-US",{timeZone:I})),E=(a,e,t)=>{const u=new Date(Date.UTC(a,e-1,t,12,0,0));return new Date(u.toLocaleString("en-US",{timeZone:I}))},y=c(new Date),l=c(null),s=c(null),r=c(null),n=c(null),o=c([]),U=c({}),N=c(!1),i=c([]),T=c([]),B=m(()=>{if(!l.value)return!1;const a=_(),[e,t,u]=l.value.date.split("-").map(Number),v=E(e,t,u),d=new Date(a.getFullYear(),a.getMonth(),a.getDate());return new Date(v.getFullYear(),v.getMonth(),v.getDate())>=d}),z=m(()=>a=>{if(!l.value)return!1;const e=_(),[t,u,v]=l.value.date.split("-").map(Number),d=E(t,u,v),f=new Date(e.getFullYear(),e.getMonth(),e.getDate()),p=new Date(d.getFullYear(),d.getMonth(),d.getDate());if(p>f)return!0;if(p<f)return!1;const g=e.getHours();switch(a){case"manana":return g<12;case"tarde":return g<18;case"noche":return g<21;default:return!1}}),M=m(()=>{if(!s.value||!l.value)return[];const a=[];let e,t;switch(s.value){case"manana":e=9,t=12;break;case"tarde":e=14,t=18;break;case"noche":e=18,t=21;break;default:return[]}const u=_(),[v,d,f]=l.value.date.split("-").map(Number),p=E(v,d,f),g=new Date(u.getFullYear(),u.getMonth(),u.getDate()),P=new Date(p.getFullYear(),p.getMonth(),p.getDate());if(P<g)return[];const W=P.getTime()===g.getTime();console.log("=== DEBUG INFO ==="),console.log("Hora actual Bolivia:",u.toLocaleString("es-BO")),console.log("Fecha seleccionada:",l.value.date),console.log("Es hoy:",W);for(let b=e;b<t;b++)for(let S=0;S<60;S+=40){const ee=b.toString().padStart(2,"0"),ae=S.toString().padStart(2,"0"),j=`${ee}:${ae}`;let F=!1;if(W){const te=new Date(v,d-1,f,b,S,0,0),le=new Date(u.getTime()+5*6e4);F=te<=le,F&&console.log(`Hora ${j} deshabilitada (ya pasó)`)}a.push({time:j,disabled:F})}return console.log("Total horas generadas:",a.length),console.log("Horas deshabilitadas:",a.filter(b=>b.disabled).length),console.log("=================="),a}),K=m(()=>{if(n.value===null)return T.value;const a=i.value.find(e=>e.id===n.value);return a?a.servicios:[]}),O=m(()=>o.value.reduce((a,e)=>a+e.duracion_estimada,0)),k=m(()=>o.value.reduce((a,e)=>a+e.precio,0)),$=m(()=>k.value===0?0:k.value*(Z.porcentajeReserva/100)),Y=m(()=>l.value&&r.value&&o.value.length>0&&B.value),q=()=>{const a=new Date(y.value);a.setDate(a.getDate()-7),y.value=a},G=()=>{const a=new Date(y.value);a.setDate(a.getDate()+7),y.value=a},J=async()=>{if(!(!l.value||!r.value)){N.value=!0;try{const a=await ie.post("/citas/barberos-disponibles",{fecha:l.value.date,hora:r.value});i.value=a.data.barberos.map(e=>({...e,avatar:Q(e.nombre),disponible:!0})),T.value=a.data.servicios,n.value=null,o.value=[]}catch(a){console.error("Error al cargar barberos:",a),alert("Error al cargar los datos. Por favor intenta nuevamente."),i.value=[],T.value=[]}finally{N.value=!1}}},Q=a=>`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&size=150`,X=()=>{if(!Y.value)return;if(!B.value){alert("La fecha seleccionada ya no está disponible");return}const a={fecha:l.value.date,hora:r.value,barbero_id:n.value,servicios:o.value.map(e=>e.id),monto_total:k.value,duracion_total:O.value,pago_inicial:$.value};ce.post("/cita/store",a,{preserveScroll:!0,preserveState:!0,onError:e=>{if(console.log(e),e&&e.error){const t=Object.values(e)[0];A.fire({title:"Error",text:t,icon:"error",confirmButtonColor:"#EF4444",background:"var(--bg-primary)",color:"var(--text-primary)"})}else A.fire({title:"Error",text:"Error al confirmar la cita",icon:"error",confirmButtonColor:"#EF4444",background:"var(--bg-primary)",color:"var(--text-primary)"})}})};return x(l,a=>{if(!a){s.value=null,r.value=null,n.value=null,o.value=[],i.value=[];return}B.value||(s.value=null,r.value=null,n.value=null,o.value=[],i.value=[]),s.value&&!z.value(s.value)&&(s.value=null,r.value=null,n.value=null,o.value=[],i.value=[])}),x(s,a=>{if(!a){r.value=null,n.value=null,o.value=[],i.value=[];return}if(r.value){const e=M.value.find(t=>t.time===r.value);(!e||e.disabled)&&(r.value=null,n.value=null,o.value=[],i.value=[])}}),x(r,a=>{a?J():(n.value=null,o.value=[],i.value=[])}),x(n,(a,e)=>{if(e!==void 0){const u=e===null?"todos":e;o.value.length>0&&(U.value[u]=[...o.value])}const t=a===null?"todos":a;o.value=U.value[t]||[]}),(a,e)=>(w(),oe(se,null,[D(L(re),{title:"Nueva Cita"}),D(de,null,{default:H(()=>[h("div",he,[D(L(ne),{href:a.route("citas-cliente.index"),class:"inline-flex items-center gap-2 mb-4 hover:opacity-75 transition-opacity",style:{color:"var(--color-primary)"}},{default:H(()=>[...e[5]||(e[5]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),ue(" Volver ",-1)])]),_:1},8,["href"]),e[6]||(e[6]=h("h1",{class:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"}}," Reservar Nueva Cita ",-1)),e[7]||(e[7]=h("p",{style:{color:"var(--text-secondary)"}}," Selecciona fecha, hora y servicio para tu cita ",-1))]),h("div",ye,[D(ve,null,{default:H(()=>[D(me,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value=t),"current-week-start":y.value,onPreviousWeek:q,onNextWeek:G},null,8,["modelValue","current-week-start"]),D(fe,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value=t),disabled:!B.value,"selected-date":l.value},null,8,["modelValue","disabled","selected-date"]),l.value&&s.value?(w(),C(pe,{key:0,modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value=t),"available-hours":M.value},null,8,["modelValue","available-hours"])):V("",!0),l.value&&r.value?(w(),C(ge,{key:1,modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value=t),barberos:i.value,loading:N.value},null,8,["modelValue","barberos","loading"])):V("",!0),l.value&&r.value&&i.value.length>0?(w(),C(be,{key:2,modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value=t),servicios:K.value},null,8,["modelValue","servicios"])):V("",!0),o.value.length>0?(w(),C(De,{key:3,"total-duracion":O.value,"total-precio":k.value,"pago-inicial":$.value,"can-confirm":Y.value,onConfirmar:X},null,8,["total-duracion","total-precio","pago-inicial","can-confirm"])):V("",!0)]),_:1})])]),_:1})],64))}};export{He as default};
